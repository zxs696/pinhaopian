// View Transition API 样式系统
// 提供丝滑无感的页面过渡动画效果

// 定义View Transition根元素
::view-transition {
  // 设置根元素的样式，确保过渡动画平滑
  animation-duration: 0.3s;
  animation-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

// 定义View Transition根元素的伪元素
::view-transition-old(root),
::view-transition-new(root) {
  // 防止动画期间的布局偏移
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  // 确保动画期间的内容不透明
  opacity: 1;
  // 防止动画期间的内容闪烁
  mix-blend-mode: normal;
  // 设置动画时间函数，使过渡更加丝滑
  animation-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

// 定义页面内容的过渡效果
::view-transition-old(main-content),
::view-transition-new(main-content) {
  // 只对主内容区应用过渡效果
  // 设置过渡时间
  animation-duration: 0.3s;
  // 设置动画时间函数，使过渡更加丝滑
  animation-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  // 设置填充模式，确保动画效果完整
  animation-fill-mode: both;
}

// 确保只有带有view-transition-target类的元素参与过渡
.view-transition-target {
  view-transition-name: main-content;
}

// 旧页面内容的淡出动画
::view-transition-old(main-content) {
  animation-name: fade-out;
}

// 新页面内容的淡入动画
::view-transition-new(main-content) {
  animation-name: fade-in;
}

// 定义淡入淡出动画
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fade-out {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-10px);
  }
}

// 定义更复杂的过渡效果（可选）
// 滑动效果
.view-transition-target.slide::view-transition-old(main-content) {
  animation-name: slide-out-left;
}

.view-transition-target.slide::view-transition-new(main-content) {
  animation-name: slide-in-right;
}

@keyframes slide-in-right {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slide-out-left {
  from {
    opacity: 1;
    transform: translateX(0);
  }
  to {
    opacity: 0;
    transform: translateX(-30px);
  }
}

// 缩放效果
.view-transition-target.scale::view-transition-old(main-content) {
  animation-name: scale-out;
}

.view-transition-target.scale::view-transition-new(main-content) {
  animation-name: scale-in;
}

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes scale-out {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(1.05);
  }
}

// 旋转效果
.view-transition-target.rotate::view-transition-old(main-content) {
  animation-name: rotate-out;
}

.view-transition-target.rotate::view-transition-new(main-content) {
  animation-name: rotate-in;
}

@keyframes rotate-in {
  from {
    opacity: 0;
    transform: rotate(-2deg) scale(0.98);
  }
  to {
    opacity: 1;
    transform: rotate(0) scale(1);
  }
}

@keyframes rotate-out {
  from {
    opacity: 1;
    transform: rotate(0) scale(1);
  }
  to {
    opacity: 0;
    transform: rotate(2deg) scale(1.02);
  }
}

// 为不支持View Transition API的浏览器提供降级方案
@supports not (view-transition-name: none) {
  // 使用传统的CSS过渡效果作为降级方案
  .view-transition-target {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  .view-transition-target.fade-enter-active,
  .view-transition-target.fade-leave-active {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  .view-transition-target.fade-enter-from {
    opacity: 0;
    transform: translateY(10px);
  }
  
  .view-transition-target.fade-leave-to {
    opacity: 0;
    transform: translateY(-10px);
  }
}

// 定义不同主题下的过渡效果
[data-theme="dark"] {
  ::view-transition-old(main-content),
  ::view-transition-new(main-content) {
    // 在暗黑模式下，可以使用稍微不同的动画时间函数
    animation-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1);
  }
}

// 定义媒体查询，在用户偏好减少动画时禁用过渡效果
@media (prefers-reduced-motion: reduce) {
  ::view-transition-old(root),
  ::view-transition-new(root),
  ::view-transition-old(main-content),
  ::view-transition-new(main-content) {
    animation-duration: 0.01s !important;
    animation-timing-function: linear !important;
  }
  
  .view-transition-target {
    animation-duration: 0.01s !important;
    animation-timing-function: linear !important;
  }
}

// 定义打印样式，在打印时禁用过渡效果
@media print {
  ::view-transition-old(root),
  ::view-transition-new(root),
  ::view-transition-old(main-content),
  ::view-transition-new(main-content) {
    animation-duration: 0s !important;
  }
  
  .view-transition-target {
    animation-duration: 0s !important;
  }
}